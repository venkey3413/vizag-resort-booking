<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Admin Panel - Resort Management</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="shortcut icon" href="logo.png">
    <link rel="stylesheet" href="style.css?v=20250103021">
</head>
<body>


    <main class="container">
        <section class="add-resort">
            <h2>Add New Resort</h2>
            <form id="resortForm">
                <input type="hidden" id="resortId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Resort Name:</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="location">Location:</label>
                        <input type="text" id="location" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="price">Price per Night (‚Çπ):</label>
                        <input type="number" id="price" required>
                    </div>
                    <div class="form-group">
                        <label for="image">Main Image:</label>
                        <input type="url" id="image" placeholder="https://..." readonly>
                        <button type="button" onclick="uploadMainImage()" class="upload-btn">üì∑ Upload Image</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gallery">Additional Images:</label>
                    <textarea id="gallery" rows="4" placeholder="Uploaded image URLs will appear here" readonly></textarea>
                    <div class="gallery-buttons">
                        <button type="button" onclick="uploadGalleryImages()" class="upload-btn">üñºÔ∏è Upload Gallery Images</button>
                        <button type="button" onclick="removeGalleryImages()" class="remove-btn">üóëÔ∏è Remove Images</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="videos">Videos:</label>
                    <textarea id="videos" rows="3" placeholder="Uploaded video URLs will appear here" readonly></textarea>
                    <button type="button" onclick="uploadVideos()" class="upload-btn">üé• Upload Videos</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mapLink">Google Map Link:</label>
                        <input type="url" id="mapLink" placeholder="https://maps.google.com/?q=location">
                    </div>
                </div>
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="amenities">Amenities (one per line):</label>
                    <textarea id="amenities" rows="4" placeholder="WiFi\nSwimming Pool\nRestaurant\nFree Parking\nGym\nSpa"></textarea>
                </div>
                <div class="form-group">
                    <label for="note">Payment Note (optional):</label>
                    <textarea id="note" rows="2" placeholder="Special instructions or notes for payment (e.g., 'Pay 50% advance', 'Full payment required')" maxlength="200"></textarea>
                    <small>This note will be displayed during payment if entered. Leave empty to hide.</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="maxGuests">Maximum Guests (optional):</label>
                        <input type="number" id="maxGuests" min="1" max="50" placeholder="e.g., 6">
                        <small>If set, shows warning when guests exceed this limit. Leave empty for no limit.</small>
                    </div>
                    <div class="form-group">
                        <label for="sortOrder">Display Order:</label>
                        <input type="number" id="sortOrder" min="0" placeholder="0" value="0">
                        <small>Lower numbers appear first on main page. Use drag-drop below to reorder.</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Dynamic Pricing:</label>
                    <div class="pricing-container">
                        <div class="pricing-row">
                            <label>Weekday (Mon-Thu):</label>
                            <input type="number" id="weekdayPrice" placeholder="‚Çπ per night">
                        </div>
                        <div class="pricing-row">
                            <label>Friday:</label>
                            <input type="number" id="fridayPrice" placeholder="‚Çπ per night">
                        </div>
                        <div class="pricing-row">
                            <label>Weekend (Sat-Sun):</label>
                            <input type="number" id="weekendPrice" placeholder="‚Çπ per night">
                        </div>
                        <div class="pricing-row">
                            <label>Holiday/Festival:</label>
                            <input type="number" id="holidayPrice" placeholder="‚Çπ per night">
                        </div>
                    </div>
                    <small>Leave empty to use base price for that day type</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="createOwnerAccount"> Create Owner Account for this Resort
                    </label>
                    <div id="ownerCredentials" class="owner-credentials" style="display:none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ownerName">Owner Name:</label>
                                <input type="text" id="ownerName" placeholder="Resort Owner Name">
                            </div>
                            <div class="form-group">
                                <label for="ownerEmail">Owner Email or Phone:</label>
                                <input type="text" id="ownerEmail" placeholder="owner@example.com or 9876543210">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ownerPassword">Owner Password:</label>
                            <input type="password" id="ownerPassword" placeholder="Minimum 6 characters">
                        </div>
                        <small>Owner can login using email or phone number to manage availability for this resort</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="createCoupon"> Create Coupon for this Resort
                    </label>
                    <div id="couponCredentials" class="coupon-credentials" style="display:none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="couponResort">Select Resort:</label>
                                <select id="couponResort">
                                    <option value="current">Current Resort Only</option>
                                    <option value="all">All Resorts (Global)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="couponCode">Coupon Code:</label>
                                <input type="text" id="couponCode" placeholder="e.g., RESORT20" maxlength="20">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="couponType">Discount Type:</label>
                                <select id="couponType">
                                    <option value="percentage">Percentage (%)</option>
                                    <option value="fixed">Fixed Amount (‚Çπ)</option>
                                </select>
                            </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="couponDiscount">Discount Value:</label>
                                <input type="number" id="couponDiscount" placeholder="20" min="1">
                            </div>
                            <div class="form-group">
                                <label for="couponDayType">Valid Days:</label>
                                <select id="couponDayType">
                                    <option value="all">All Days</option>
                                    <option value="weekday">Weekdays (Mon-Fri)</option>
                                    <option value="weekend">Weekends (Sat-Sun)</option>
                                </select>
                            </div>
                        </div>
                        <small>Coupon will be available for customers to use during booking</small>
                    </div>
                </div>
                <button type="submit" id="submitBtn">Add Resort</button>
                <button type="button" id="cancelBtn" onclick="cancelEdit()" style="display:none;">Cancel</button>
            </form>
        </section>

        <section class="resorts-list">
            <h2>Manage Resorts</h2>
            <div class="resort-ordering">
                <h3>Resort Display Order</h3>
                <p>Drag and drop to reorder how resorts appear on the main page:</p>
                <div id="sortableResorts" class="sortable-resorts">
                    <!-- Sortable resort list will be loaded here -->
                </div>
                <button id="saveOrderBtn" onclick="saveResortOrder()" class="save-order-btn" style="display:none;">üíæ Save New Order</button>
            </div>
            <div id="resortsGrid" class="resorts-grid">
                <!-- Resorts will be loaded here -->
            </div>
        </section>

        <section class="add-event">
            <h2>Add New Event</h2>
            <form id="eventForm">
                <input type="hidden" id="eventId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventName">Event Name:</label>
                        <input type="text" id="eventName" required>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">Location:</label>
                        <input type="text" id="eventLocation" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventPrice">Price per Event (‚Çπ):</label>
                        <input type="number" id="eventPrice" required>
                    </div>
                    <div class="form-group">
                        <label for="eventImage">Main Image:</label>
                        <input type="url" id="eventImage" placeholder="https://..." readonly>
                        <button type="button" onclick="uploadEventMainImage()" class="upload-btn">üì∑ Upload Image</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="eventGallery">Additional Images:</label>
                    <textarea id="eventGallery" rows="4" placeholder="Uploaded image URLs will appear here" readonly></textarea>
                    <div class="gallery-buttons">
                        <button type="button" onclick="uploadEventGalleryImages()" class="upload-btn">üñºÔ∏è Upload Gallery Images</button>
                        <button type="button" onclick="removeEventGalleryImages()" class="remove-btn">üóëÔ∏è Remove Images</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="eventVideos">Videos:</label>
                    <textarea id="eventVideos" rows="3" placeholder="Uploaded video URLs will appear here" readonly></textarea>
                    <button type="button" onclick="uploadEventVideos()" class="upload-btn">üé• Upload Videos</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventMapLink">Google Map Link:</label>
                        <input type="url" id="eventMapLink" placeholder="https://maps.google.com/?q=location">
                    </div>
                </div>
                <div class="form-group">
                    <label for="eventDescription">Description:</label>
                    <textarea id="eventDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="eventAmenities">Amenities (one per line):</label>
                    <textarea id="eventAmenities" rows="4" placeholder="Sound System\nLighting\nDecoration\nCatering\nPhotography\nDJ"></textarea>
                </div>
                <div class="form-group">
                    <label for="eventNote">Payment Note (optional):</label>
                    <textarea id="eventNote" rows="2" placeholder="Special instructions or notes for payment (e.g., 'Pay 50% advance', 'Full payment required')" maxlength="200"></textarea>
                    <small>This note will be displayed during payment if entered. Leave empty to hide.</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventMaxGuests">Maximum Guests (optional):</label>
                        <input type="number" id="eventMaxGuests" min="1" max="500" placeholder="e.g., 100">
                        <small>If set, shows warning when guests exceed this limit. Leave empty for no limit.</small>
                    </div>
                    <div class="form-group">
                        <label for="eventSortOrder">Display Order:</label>
                        <input type="number" id="eventSortOrder" min="0" placeholder="0" value="0">
                        <small>Lower numbers appear first on events page. Use drag-drop below to reorder.</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Dynamic Pricing:</label>
                    <div class="pricing-container">
                        <div class="pricing-row">
                            <label>Event Type:</label>
                            <select id="eventType">
                                <option value="birthday">Birthday Party</option>
                                <option value="wedding">Wedding</option>
                                <option value="corporate">Corporate Event</option>
                                <option value="engagement">Engagement</option>
                                <option value="pool-party">Pool Party</option>
                                <option value="anniversary">Anniversary</option>
                            </select>
                        </div>
                        <div class="pricing-row">
                            <label>Weekday (Mon-Thu):</label>
                            <input type="number" id="eventWeekdayPrice" placeholder="‚Çπ per event">
                        </div>
                        <div class="pricing-row">
                            <label>Friday:</label>
                            <input type="number" id="eventFridayPrice" placeholder="‚Çπ per event">
                        </div>
                        <div class="pricing-row">
                            <label>Weekend (Sat-Sun):</label>
                            <input type="number" id="eventWeekendPrice" placeholder="‚Çπ per event">
                        </div>
                        <div class="pricing-row">
                            <label>Holiday/Festival:</label>
                            <input type="number" id="eventHolidayPrice" placeholder="‚Çπ per event">
                        </div>
                    </div>
                    <small>Leave empty to use base price for that day type</small>
                </div>
                <button type="submit" id="eventSubmitBtn">Add Event</button>
                <button type="button" id="eventCancelBtn" onclick="cancelEventEdit()" style="display:none;">Cancel</button>
            </form>
        </section>

        <section class="events-list">
            <h2>Manage Events</h2>
            <div class="event-ordering">
                <h3>Event Display Order</h3>
                <p>Drag and drop to reorder how events appear on the events page:</p>
                <div id="sortableEvents" class="sortable-events">
                    <!-- Sortable event list will be loaded here -->
                </div>
                <button id="saveEventOrderBtn" onclick="saveEventOrder()" class="save-order-btn" style="display:none;">üíæ Save New Order</button>
            </div>
            <div id="eventsGrid" class="events-grid">
                <!-- Events will be loaded here -->
            </div>
        </section>

        <section class="coupon-management">
            <h2>Coupon Management</h2>
            
            <div class="coupon-form">
                <h3>Create New Coupon</h3>
                <form id="standaloneCouponForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standaloneCouponCode">Coupon Code:</label>
                            <input type="text" id="standaloneCouponCode" placeholder="e.g., SILVER10" maxlength="20" required>
                        </div>
                        <div class="form-group">
                            <label for="standaloneCouponType">Discount Type:</label>
                            <select id="standaloneCouponType" required>
                                <option value="percentage">Percentage (%)</option>
                                <option value="fixed">Fixed Amount (‚Çπ)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standaloneCouponDiscount">Discount Value:</label>
                            <input type="number" id="standaloneCouponDiscount" placeholder="1000" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="standaloneCouponDayType">Valid Days:</label>
                            <select id="standaloneCouponDayType" required>
                                <option value="all">All Days</option>
                                <option value="weekday">Weekdays (Mon-Thu)</option>
                                <option value="weekend">Weekends (Fri-Sun)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="standaloneCouponResort">Valid For Resort:</label>
                        <select id="standaloneCouponResort" required>
                            <option value="">All Resorts (Global)</option>
                            <!-- Resort options will be loaded here -->
                        </select>
                    </div>
                    <button type="submit">Create Coupon</button>
                </form>
            </div>
            
            <div class="coupon-list">
                <h3>Active Coupons</h3>
                <div id="couponsGrid" class="coupons-grid">
                    <!-- Coupons will be loaded here -->
                </div>
            </div>
        </section>

        <section class="owner-management">
            <h2>Owner Management</h2>
            <div class="owner-list">
                <h3>Resort Owners</h3>
                <div id="ownersGrid" class="owners-grid">
                    <!-- Owners will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // Replace with your Cloudinary cloud name
        const CLOUDINARY_CLOUD_NAME = 'dqdclezfo';
        
        function uploadMainImage() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_images',
                sources: ['local', 'url'],
                multiple: false,
                resourceType: 'image',
                maxFileSize: 10000000,
                cropping: true,
                croppingAspectRatio: 16/9
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    document.getElementById('image').value = result.info.secure_url;
                }
            });
        }
        
        function uploadGalleryImages() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_images',
                sources: ['local', 'url'],
                multiple: true,
                resourceType: 'image',
                maxFileSize: 10000000
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    const currentGallery = document.getElementById('gallery').value;
                    const newUrl = result.info.secure_url;
                    const updatedGallery = currentGallery ? currentGallery + '\n' + newUrl : newUrl;
                    document.getElementById('gallery').value = updatedGallery;
                }
            });
        }
        
        function removeGalleryImages() {
            const galleryTextarea = document.getElementById('gallery');
            const currentGallery = galleryTextarea.value.trim();
            
            if (!currentGallery) {
                alert('No images to remove');
                return;
            }
            
            const images = currentGallery.split('\n').filter(url => url.trim());
            
            if (images.length === 0) {
                alert('No images to remove');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'image-removal-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>Select Images to Remove</h3>
                    <div class="images-grid">
                        ${images.map((url, index) => `
                            <div class="image-item">
                                <img src="${url}" alt="Gallery Image ${index + 1}">
                                <label>
                                    <input type="checkbox" value="${index}"> Remove
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button onclick="confirmRemoveResortImages()">Remove Selected</button>
                        <button onclick="closeResortRemovalModal()">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            window.confirmRemoveResortImages = function() {
                const checkboxes = modal.querySelectorAll('input[type="checkbox"]:checked');
                const indicesToRemove = Array.from(checkboxes).map(cb => parseInt(cb.value));
                
                if (indicesToRemove.length === 0) {
                    alert('Please select at least one image to remove');
                    return;
                }
                
                const remainingImages = images.filter((_, index) => !indicesToRemove.includes(index));
                galleryTextarea.value = remainingImages.join('\n');
                
                closeResortRemovalModal();
                alert(`Removed ${indicesToRemove.length} image(s)`);
            };
            
            window.closeResortRemovalModal = function() {
                modal.remove();
                delete window.confirmRemoveResortImages;
                delete window.closeResortRemovalModal;
            };
        }
        
        function uploadVideos() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_videos',
                sources: ['local', 'url'],
                multiple: true,
                resourceType: 'video',
                maxFileSize: 100000000
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    const currentVideos = document.getElementById('videos').value;
                    const newUrl = result.info.secure_url;
                    const updatedVideos = currentVideos ? currentVideos + '\n' + newUrl : newUrl;
                    document.getElementById('videos').value = updatedVideos;
                }
            });
        }
        
        // Event Management Functions
        function uploadEventMainImage() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_images',
                sources: ['local', 'url'],
                multiple: false,
                resourceType: 'image',
                maxFileSize: 10000000,
                cropping: true,
                croppingAspectRatio: 16/9
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    document.getElementById('eventImage').value = result.info.secure_url;
                }
            });
        }
        
        function uploadEventGalleryImages() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_images',
                sources: ['local', 'url'],
                multiple: true,
                resourceType: 'image',
                maxFileSize: 10000000
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    const currentGallery = document.getElementById('eventGallery').value;
                    const newUrl = result.info.secure_url;
                    const updatedGallery = currentGallery ? currentGallery + '\n' + newUrl : newUrl;
                    document.getElementById('eventGallery').value = updatedGallery;
                }
            });
        }
        
        function removeEventGalleryImages() {
            const galleryTextarea = document.getElementById('eventGallery');
            const currentGallery = galleryTextarea.value.trim();
            
            if (!currentGallery) {
                alert('No images to remove');
                return;
            }
            
            const images = currentGallery.split('\n').filter(url => url.trim());
            
            if (images.length === 0) {
                alert('No images to remove');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'image-removal-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>Select Images to Remove</h3>
                    <div class="images-grid">
                        ${images.map((url, index) => `
                            <div class="image-item">
                                <img src="${url}" alt="Event Image ${index + 1}">
                                <label>
                                    <input type="checkbox" value="${index}"> Remove
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button onclick="confirmRemoveEventImages()">Remove Selected</button>
                        <button onclick="closeEventRemovalModal()">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            window.confirmRemoveEventImages = function() {
                const checkboxes = modal.querySelectorAll('input[type="checkbox"]:checked');
                const indicesToRemove = Array.from(checkboxes).map(cb => parseInt(cb.value));
                
                if (indicesToRemove.length === 0) {
                    alert('Please select at least one image to remove');
                    return;
                }
                
                const remainingImages = images.filter((_, index) => !indicesToRemove.includes(index));
                galleryTextarea.value = remainingImages.join('\n');
                
                closeEventRemovalModal();
                alert(`Removed ${indicesToRemove.length} image(s)`);
            };
            
            window.closeEventRemovalModal = function() {
                modal.remove();
                delete window.confirmRemoveEventImages;
                delete window.closeEventRemovalModal;
            };
        }
        
        function uploadEventVideos() {
            cloudinary.openUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: 'resort_videos',
                sources: ['local', 'url'],
                multiple: true,
                resourceType: 'video',
                maxFileSize: 100000000
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    const currentVideos = document.getElementById('eventVideos').value;
                    const newUrl = result.info.secure_url;
                    const updatedVideos = currentVideos ? currentVideos + '\n' + newUrl : newUrl;
                    document.getElementById('eventVideos').value = updatedVideos;
                }
            });
        }
        
        function cancelEventEdit() {
            document.getElementById('eventForm').reset();
            document.getElementById('eventId').value = '';
            document.getElementById('eventSubmitBtn').textContent = 'Add Event';
            document.getElementById('eventCancelBtn').style.display = 'none';
        }
        

    </script>
    <script src="script.js?v=20250103035"></script>
</body>
</html>