<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .resort-card { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .tabs { display: flex; gap: 10px; margin: 20px 0; }
        .tab-btn { padding: 10px 20px; background: #e9ecef; border: none; cursor: pointer; }
        .tab-btn.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Resort Admin Panel</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="showTab('add-resort')">Add Resort</button>
            <button class="tab-btn" onclick="showTab('manage-resorts')">Manage Resorts</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <h2>Dashboard</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalResorts">0</h3>
                    <p>Total Resorts</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalBookings">0</h3>
                    <p>Total Bookings</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalRevenue">₹0</h3>
                    <p>Total Revenue</p>
                </div>
                <div class="stat-card">
                    <h3 id="todayBookings">0</h3>
                    <p>Today's Bookings</p>
                </div>
            </div>
        </div>

        <div id="add-resort" class="tab-content">
            <h2>Add New Resort</h2>
            <form id="addResortForm">
                <div class="form-group">
                    <label>Resort Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" name="location" required>
                </div>
                <div class="form-group">
                    <label>Price per Night (₹)</label>
                    <input type="number" name="price" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label>Amenities (comma separated)</label>
                    <input type="text" name="amenities" placeholder="Swimming Pool, Spa, WiFi">
                </div>
                <button type="submit" class="btn">Add Resort</button>
            </form>
        </div>

        <div id="manage-resorts" class="tab-content">
            <h2>Manage Resorts</h2>
            <div id="resortsGrid"></div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function loadDashboard() {
            try {
                const response = await fetch('/api/analytics/dashboard');
                const data = await response.json();
                document.getElementById('totalResorts').textContent = data.totalResorts;
                document.getElementById('totalBookings').textContent = data.totalBookings;
                document.getElementById('totalRevenue').textContent = '₹' + (data.totalRevenue || 0).toLocaleString();
                document.getElementById('todayBookings').textContent = data.todayBookings;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        async function loadResorts() {
            try {
                const response = await fetch('/api/resorts');
                const resorts = await response.json();
                const grid = document.getElementById('resortsGrid');
                grid.innerHTML = resorts.map(resort => `
                    <div class="resort-card">
                        <h3>${resort.name}</h3>
                        <p><strong>Location:</strong> ${resort.location}</p>
                        <p><strong>Price:</strong> ₹${resort.price}/night</p>
                        <p><strong>Description:</strong> ${resort.description}</p>
                        <button class="btn" onclick="deleteResort(${resort.id})">Delete</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading resorts:', error);
            }
        }

        document.getElementById('addResortForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'),
                location: formData.get('location'),
                price: parseInt(formData.get('price')),
                description: formData.get('description'),
                amenities: formData.get('amenities').split(',').map(a => a.trim()),
                images: [],
                videos: []
            };

            try {
                const response = await fetch('/api/resorts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    alert('Resort added successfully!');
                    e.target.reset();
                    loadResorts();
                } else {
                    alert('Failed to add resort');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        async function deleteResort(id) {
            if (confirm('Delete this resort?')) {
                try {
                    const response = await fetch(`/api/resorts/${id}`, { method: 'DELETE' });
                    if (response.ok) {
                        alert('Resort deleted!');
                        loadResorts();
                    }
                } catch (error) {
                    alert('Delete failed: ' + error.message);
                }
            }
        }

        // Load data on page load
        loadDashboard();
        loadResorts();
    </script>
</body>
</html>