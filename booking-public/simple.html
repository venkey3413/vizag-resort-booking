<!DOCTYPE html>
<html>
<head>
    <title>Booking Management</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
        .booking-card { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .btn { background: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status.confirmed { background: #d4edda; color: #155724; }
        .status.pending { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Booking Management</h1>
        
        <div class="stats">
            <div class="stat-card">
                <h3 id="totalBookings">0</h3>
                <p>Total Bookings</p>
            </div>
            <div class="stat-card">
                <h3 id="totalRevenue">₹0</h3>
                <p>Total Revenue</p>
            </div>
        </div>

        <h2>All Bookings</h2>
        <div id="bookingsGrid"></div>
    </div>

    <script>
        async function loadBookings() {
            try {
                const response = await fetch('/api/bookings');
                const bookings = await response.json();
                
                let totalRevenue = 0;
                bookings.forEach(booking => {
                    if (booking.payment_status === 'completed') {
                        totalRevenue += booking.total_price;
                    }
                });

                document.getElementById('totalBookings').textContent = bookings.length;
                document.getElementById('totalRevenue').textContent = '₹' + totalRevenue.toLocaleString();

                const grid = document.getElementById('bookingsGrid');
                grid.innerHTML = bookings.map(booking => `
                    <div class="booking-card">
                        <h3>Booking #${booking.id}</h3>
                        <p><strong>Guest:</strong> ${booking.guest_name}</p>
                        <p><strong>Resort:</strong> ${booking.resort_name || 'N/A'}</p>
                        <p><strong>Check-in:</strong> ${new Date(booking.check_in).toLocaleDateString()}</p>
                        <p><strong>Check-out:</strong> ${new Date(booking.check_out).toLocaleDateString()}</p>
                        <p><strong>Guests:</strong> ${booking.guests}</p>
                        <p><strong>Total:</strong> ₹${booking.total_price.toLocaleString()}</p>
                        <p><strong>Status:</strong> <span class="status ${booking.status}">${booking.status}</span></p>
                        <p><strong>Payment:</strong> <span class="status ${booking.payment_status}">${booking.payment_status}</span></p>
                        <p><strong>Booked:</strong> ${new Date(booking.booking_date).toLocaleString()}</p>
                        <button class="btn" onclick="updatePayment(${booking.id}, 'completed')">Mark Paid</button>
                        <button class="btn danger" onclick="deleteBooking(${booking.id})">Delete</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading bookings:', error);
                document.getElementById('bookingsGrid').innerHTML = '<p>Error loading bookings</p>';
            }
        }

        async function updatePayment(id, status) {
            try {
                const response = await fetch(`/api/bookings/${id}/payment`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ payment_status: status })
                });
                
                if (response.ok) {
                    alert('Payment status updated!');
                    loadBookings();
                } else {
                    alert('Failed to update payment status');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function deleteBooking(id) {
            if (confirm('Delete this booking?')) {
                try {
                    const response = await fetch(`/api/bookings/${id}`, { method: 'DELETE' });
                    if (response.ok) {
                        alert('Booking deleted!');
                        loadBookings();
                    } else {
                        alert('Failed to delete booking');
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        // Load data on page load
        loadBookings();
    </script>
</body>
</html>