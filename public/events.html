<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Events Booking - VShaka Go</title>

  <link rel="icon" type="image/png" href="logo.png" />

  <!-- âœ… Premium Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Plus+Jakarta+Sans:wght@700;800;900&display=swap" rel="stylesheet">

  <!-- âœ… Load your premium UI -->
  <link rel="stylesheet" href="premium-ui.css" />

  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>

<body>

  <!-- âœ… PREMIUM NAVBAR -->
  <header class="vrb-navbar">
    <div class="vrb-nav-container">

      <a href="index.html" class="vrb-logo">
        <img src="logo.png" alt="Logo">
        <div class="logo-caption">
          <span>Vizag Starts Here & Go</span>
        </div>
      </a>

      <nav class="vrb-nav-links" id="vrbNavLinks">
      </nav>

      <div class="vrb-nav-actions">
        <a class="vrb-whatsapp" href="https://wa.me/918341674465" target="_blank">WhatsApp</a>
        <a class="vrb-btn-nav" href="index.html#resorts">Book Resort</a>
        <button class="vrb-hamburger" onclick="vrbToggleMenu()">â˜°</button>
      </div>
    </div>
  </header>

  <!-- âœ… ICON BUTTONS SECTION -->
  <section class="vrb-icon-buttons">
    <div class="vrb-icon-container">
      <button class="vrb-icon-btn" onclick="window.location.href='events.html'">
        <span class="icon">ğŸ‰</span>
        <span class="text">Events</span>
      </button>
      <button class="vrb-icon-btn" onclick="window.location.href='index.html'">
        <span class="icon">ğŸ¨</span>
        <span class="text">Hotel</span>
      </button>
    </div>
  </section>

  <!-- âœ… EVENTS SECTION -->
  <section id="events" class="vrb-section">
    <div class="vrb-container">
      <div class="vrb-section-head vrb-anim">
        <h2 class="vrb-title">Events & Party Bookings in Vizag</h2>
        <p class="vrb-subtitle">
          Birthday â€¢ Wedding â€¢ Corporate â€¢ Engagement â€¢ Pool Parties
        </p>
      </div>

      <div class="vrb-grid" id="eventsGrid">
        <!-- Events will be loaded dynamically -->
      </div>
    </div>
  </section>

  <!-- âœ… FOOTER -->
  <footer id="contact" class="vrb-footer">
    <div class="vrb-container vrb-footer-grid vrb-anim">

      <div>
        <h3>Vizag Starts Here & Go</h3>
        <p>
          Resorts + Events booking in Vizag.<br>
          Premium verified listings with best deals.
        </p>

        <div class="vrb-footer-badges">
          <span>âœ… Verified</span>
          <span>âš¡ Instant Booking</span>
          <span>ğŸ’° Best Price</span>
        </div>
      </div>

      <div>
        <h4>Quick Links</h4>
        <a href="index.html">Home</a>
        <a href="index.html#resorts">Resorts</a>
        <a href="events.html">Events</a>
      </div>

      <div>
        <h4>Support</h4>
        <a href="tel:+918341674465">ğŸ“ +91 8341674465</a>
        <a href="mailto:vizagresortbooking@gmail.com">âœ‰ï¸ vizagresortbooking@gmail.com</a>
        <a href="https://wa.me/918341674465" target="_blank">ğŸ’¬ WhatsApp Support</a>
      </div>

    </div>

    <div class="vrb-footer-bottom">
      Â© 2026 Vizag Starts Here & Go â€¢ Built with â¤ï¸ in Vizag
    </div>
  </footer>

  <a class="vrb-policy-btn" href="Cancellation & terms and conditions (1).pdf" target="_blank">
    ğŸ“„ Policy
  </a>

  <!-- âœ… SCRIPTS -->
  <script>
    let events = [];

    function vrbToggleMenu() {
      document.getElementById("vrbNavLinks").classList.toggle("open");
    }

    // Load events from API
    async function loadEvents() {
      try {
        const response = await fetch('/api/events');
        events = await response.json();
        displayEvents();
        console.log('Loaded events:', events.length);
      } catch (error) {
        console.error('Error loading events:', error);
        document.getElementById('eventsGrid').innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Failed to load events. Please refresh the page.</div>';
      }
    }

    function displayEvents() {
      const grid = document.getElementById('eventsGrid');
      if (!grid) return;
      
      if (!events || events.length === 0) {
        grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No events available at the moment.</div>';
        return;
      }
      
      grid.innerHTML = events.map(event => {
        const amenitiesList = event.amenities ? event.amenities.split('\n').filter(a => a.trim()).slice(0, 4) : [];
        const eventTypeMap = {
          'birthday': 'Birthday Party',
          'wedding': 'Wedding',
          'corporate': 'Corporate Event',
          'engagement': 'Engagement',
          'pool-party': 'Pool Party',
          'anniversary': 'Anniversary'
        };
        const displayName = eventTypeMap[event.event_type] || event.name;
        
        return `
          <div class="vrb-card">
            <div class="vrb-img">
              <img src="${event.image}" alt="${event.name}" onerror="this.src='https://images.unsplash.com/photo-1464366400600-7168b8af9bc3?w=400'">
              <div class="vrb-badge">â‚¹${event.price.toLocaleString()}</div>
            </div>
            <div class="vrb-body">
              <h3>${displayName}</h3>
              <p class="vrb-meta">ğŸ“ ${event.location} â€¢ ğŸ‘¥ ${event.max_guests ? event.max_guests + ' Guests' : 'Flexible'}</p>
              <div class="vrb-tags">
                ${amenitiesList.map(amenity => `<span>${amenity.trim()}</span>`).join('')}
              </div>
              <div class="vrb-bottom">
                <div class="vrb-price">â‚¹${event.price.toLocaleString()} <span>/event</span></div>
                <button class="vrb-btn-primary" onclick="bookEvent(${event.id})">Book Event</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function bookEvent(eventId) {
      // For now, redirect to WhatsApp with event details
      const event = events.find(e => e.id === eventId);
      if (event) {
        const message = `Hi! I want to book ${event.name} at ${event.location} for â‚¹${event.price.toLocaleString()}. Please provide more details.`;
        const whatsappUrl = `https://wa.me/918341674465?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
      }
    }

    // Setup Redis real-time updates
    function setupRedisSync() {
      console.log('ğŸ“¡ Redis real-time sync enabled for events page');
      
      let eventSource;
      let reconnectAttempts = 0;
      const maxReconnectAttempts = 5;
      
      function connectEventSource() {
        try {
          eventSource = new EventSource('/api/events-stream');
          
          eventSource.onmessage = function(event) {
            try {
              const data = JSON.parse(event.data);
              console.log('ğŸ“¡ Events page Redis event received:', data);
              
              if (data.type === 'event.updated' || data.type === 'event.created' || data.type === 'event.deleted') {
                console.log('ğŸ‰ Event update received - refreshing events');
                loadEvents();
              }
            } catch (error) {
              // Ignore ping messages
            }
          };
          
          eventSource.onerror = function(error) {
            console.log('âš ï¸ Events page Redis connection error, attempting reconnect...');
            eventSource.close();
            
            if (reconnectAttempts < maxReconnectAttempts) {
              reconnectAttempts++;
              setTimeout(connectEventSource, 2000 * reconnectAttempts);
            } else {
              console.log('âŒ Max reconnection attempts reached');
            }
          };
          
          eventSource.onopen = function() {
            console.log('âœ… Redis connected to events page');
            reconnectAttempts = 0;
          };
        } catch (error) {
          console.error('Events page Redis setup failed:', error);
        }
      }
      
      connectEventSource();
    }

    // Enhanced Animation System
    document.addEventListener('DOMContentLoaded', function() {
      // Load events on page load
      loadEvents();
      
      // Setup Redis sync after a delay
      setTimeout(setupRedisSync, 1000);
      
      // Scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate');
          }
        });
      }, observerOptions);

      // Observe all animation elements
      document.querySelectorAll('.vrb-anim').forEach(el => {
        observer.observe(el);
      });

      // Button click animations
      document.querySelectorAll('button, .vrb-btn, .vrb-btn-primary').forEach(btn => {
        btn.addEventListener('click', function() {
          this.classList.add('bounce-on-click');
          setTimeout(() => {
            this.classList.remove('bounce-on-click');
          }, 600);
        });
      });
    });
  </script>

</body>
</html>